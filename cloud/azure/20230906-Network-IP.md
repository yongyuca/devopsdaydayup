# IP
既然讲到网络，那必须得讲的一个概念就是**IP**了。IP的全称是**Internet Protocol（互联网协议)**。顾名思义，它是互联网的一种传输协议。在网络上，**我们使用IP来定位一个资源**，比如一台电脑或一个设备终端。它就是网络里资源的住宅地址，你只有拥有了这个地址，别人才能通过网络找到你。IP有非常多版本，v1到v9都有，其中使用最广泛的就是我们所熟知的**IPv4**和**IPv6**。1995年就设计出来的IPv6是为了替代数量已经不够用了的1983年就设计了的IPv4，但直到今天，这两个版本依旧都在被同时广泛的使用着。它们分别是使用句号(IPv4)或冒号(IPv6)来分割的一串十进制(IPv4)或十六进制(IPv6)的数字所构成，比如IPv4长这样192.0.2.1, 而IPv6长这样 2001:db8:0:1234:0:567:8:1. </br>

这两个版本的IP地址都可以再分为多个子网(Subnet)。前半段是网络段(Network identifier)，后半段是主机段(IPv4是Host identifier或者IPv6是interface identifier)。这个网段的划分如果类比到我们生活中，你可以理解为是一栋公寓里的一间房间。网络段代表这栋公寓的具体地址，比如哪个城市哪个区的哪个街道的公寓，而主机段就是这间房间在这个公寓里的相对位置，比如301（3楼第1间)。关于这个子网划分，其实还有一个有意思的演变过程。一开始的IPv4只使用了前八位，也就是只有256个子网。很显然，这个数量百分百不够用啊。于是乎，人们就引入了分类网络架构(Classful Network Architecture)，分别是A类, B类, C类。A类支持16777216台主机设备，B类支持65536台主机设备，C类支持256台主机设备。子网数量是稍微够了，但是这又引入了另一个问题，就是资源的极大浪费。比如，我需要270台电脑的子网，显然C类是不能满足我的，必须选在A类或B类，但是无论哪个类，都有相当大的一部分地址处于没有被使用的状态。于是乎，另一项很著名的技术就诞生了，它就是CIDR(Classless Inter-Domain Routing无类域间路由)。CIDR是基于可变长度子网掩码（VLSM:variable-length subnet masking），允许基于任意长度的前缀进行分配和路由。CIDR里的C（Classless)就是针对之前的Class而言的。我们在Azure的网络里分类的时候，你会看到IP地址后面还跟着一个斜杆加数字，比如/24，这个就是CIDR。它的出现使得网络段和主机段不再固定，而是可以通过子网掩码(比如/24)来计算出来。具体计算方式我们就不细说，感兴趣的同学可以网上找文章看看。你所要知道的是，现在你的地址必须通过IP地址加上子网掩码才能被路由到。</br>

以上是IP的定义和有意思的子网演化历史，接下来是一些其他有意思的关于IP的小知识，大家可以了解一下：
1. 全球的IP地址是由一个叫做**Internet Assigned Numbers Authorit**(IANA)的机构管理的。
2. 每个地区有一个叫做Regional Internet Registries (RIRs)的机构,它们负责从IANA那里拿IP， 然后再分配给它们底下的互联网服务提供商(ISP:Internet Service Provider)或者某些终端用户。这个RIRs全世界只有5个。
3. IPv4从2011年开始就不够用了。
4. IPv4的地址有一部分我们称为**私有地址**，这些地址无法在公共区域使用(公共路由器会把他们过滤了)。它们只能在自己的局域网里用，这就是我们熟悉的10.x.x.x，172.16.x.x 或者192.168.x.x，这类地址。你打开你的电脑或手机，用的就是这类地址。IPv6的私有地址是：fc00::/7
5. 使用私有地址的用户通过NAT(Network Address Translation)的技术和互联网联系。简单的说，NAT把你的私有地址转换成了互联网里可以使用的公有地址，然后去和互联网通讯。它就好像你公寓门口的看门大爷，你通过大爷向外通讯，别人要找你，也是通过大爷来转达。
6. 除了私有地址，还有一类特别的地址在公共网络上不被传输，它就是**Loopback回环地址**。IPv4是127.x.x.x，IPv6是::1。这也是我们通常所说的localhost，这个地址指向的是网卡它自己，它主要是用来测试网卡本身是否有问题，这个在我们平常检测网络问题的时候用的比较多。
7. IP可以通过DHCP（Dynamic Host Configuration Protocol)的协议动态分配，这类IP我们叫动态IP(dynamic IP address)。它也可以手动分别，我们称为静态IP(static IP address)。
8. 在IPv4里，每个子网的最后一个地址都是保留地址，它被用来做广播使用(Broadcast addressing)，也就是说，如果你向这个地址发送信息，这个信息会被广播到这个子网段里的所有主机。比如在192.0.2.0/24这个网段里的最后一个地址 192.0.2.255，它就是广播地址。
9. IPv6没有广播地址，它有的是在IPv4里也有的多播地址(Multicast addressing)，这个地址段是224.0.0.0 到 239.255.255.255，之前也叫类别D。IPv6的多播地址是ff00::/8。当你向这类地址发送信息的时候，这些信息会被广播到之前已经设置好对某一特定多播地址加关注的主机上。换句话说，你只有关注了这个大V，那你才会收到这个大V发的微博。
10. 最后再介绍一种路由方式，Anycast（任意播)，当你通过这种方式传播时，它的传输的对象是多个，但是最终只会挑选一个传输路径最短的主机传输。IPv6内置这个功能，IPv4必须通过BGP协议才能实现。运用Anycast最知名的技术就是CDN(Content Delivery Networks)了。